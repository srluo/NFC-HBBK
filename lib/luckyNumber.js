// /lib/luckyNumber.js â€” v1.8.0-stable
// ğŸ¯ è¨ˆç®—ç”Ÿå‘½éˆæ•¸ï¼ˆæ”¯æ´ 11 / 22 / 33 å¤§å¸«æ•¸ï¼‰
// ----------------------------------------------------
// ğŸ”¹ è¼¸å…¥ï¼šYYYYMMDD (string)ï¼Œä¾‹å¦‚ "19650404"
// ğŸ”¹ å›å‚³ï¼š{ lucky_number: "11ï¼ˆå¤§å¸«æ•¸ï¼‰", lucky_desc: "..." }
// ----------------------------------------------------

export function getLuckyNumber(dateStr) {
  // ğŸ§© å®‰å…¨é˜²å‘†ï¼šé•·åº¦ä¸ç¬¦ç›´æ¥å›å‚³ç©º
  if (!dateStr || typeof dateStr !== "string" || dateStr.length !== 8) {
    return { lucky_number: "", lucky_desc: "" };
  }

  // â‘  æ‹†è§£ç‚ºæ•¸å­—é™£åˆ—
  let digits = dateStr.split("").map((d) => parseInt(d, 10));
  let sum = digits.reduce((a, b) => a + b, 0);

  // â‘¡ æŒçºŒç›¸åŠ ç›´åˆ°ç‚ºä¸€ä½æ•¸æˆ–å¤§å¸«æ•¸
  while (sum > 9 && sum !== 11 && sum !== 22 && sum !== 33) {
    sum = sum
      .toString()
      .split("")
      .reduce((a, b) => a + parseInt(b, 10), 0);
  }

  // â‘¢ åˆ¤æ–·æ˜¯å¦ç‚ºå¤§å¸«æ•¸
  const masterNumber = [11, 22, 33].includes(sum) ? sum : null;

  // â‘£ æœ€çµ‚ç”Ÿå‘½éˆæ•¸
  const number = masterNumber ? (sum === 33 ? 6 : Math.floor(sum / 11)) : sum;

  // â‘¤ å°æ‡‰æè¿°
  const descMap = {
    1: "ç¨ç«‹èˆ‡é ˜å°ï¼Œå¤©ç”Ÿçš„é–‹å‰µè€…ã€‚",
    2: "æ•éŠ³ç›´è¦ºï¼Œé‡è¦–åˆä½œèˆ‡é—œä¿‚å¹³è¡¡ã€‚",
    3: "å‰µæ„è±å¯Œï¼Œæ“…é•·è¡¨é”èˆ‡æºé€šã€‚",
    4: "ç©©å®šå‹™å¯¦ï¼Œé‡è¦–ç§©åºèˆ‡å®‰å…¨æ„Ÿã€‚",
    5: "ç†±æ„›è‡ªç”±ï¼Œå‹‡æ–¼å˜—è©¦æ–°äº‹ç‰©ã€‚",
    6: "é—œæ„›ä»–äººï¼Œé‡è¦–å®¶åº­èˆ‡è²¬ä»»æ„Ÿã€‚",
    7: "æ€è€ƒæ·±é‚ƒï¼Œè¿½æ±‚çœŸç†èˆ‡çŸ¥è­˜ã€‚",
    8: "å…·ä¼åœ–å¿ƒï¼Œé‡è¦–æ¬ŠåŠ›èˆ‡æˆå°±ã€‚",
    9: "å¿ƒæ‡·ä¸–ç•Œï¼Œå¯Œæœ‰æ…ˆæ‚²èˆ‡ç†æƒ³æ€§ã€‚",
    11: "æ“æœ‰å¼·çƒˆç›´è¦ºèˆ‡éˆæ€§æ´å¯ŸåŠ›ã€‚",
    22: "æ“æœ‰å®è§€é¡˜æ™¯èˆ‡å¯¦è¸å¤§å¤¢çš„èƒ½åŠ›ã€‚",
    33: "å…·æœ‰ç™‚ç™’èƒ½é‡èˆ‡ç„¡ç§å¥‰ç»ç²¾ç¥ã€‚",
  };

  // â‘¥ çµ„åˆè¼¸å‡ºæ ¼å¼
  const lucky_number = masterNumber
    ? `${masterNumber}ï¼ˆå¤§å¸«æ•¸ï¼‰`
    : `${number}`;
  const lucky_desc = descMap[masterNumber || number] || "";

  return { lucky_number, lucky_desc };
}